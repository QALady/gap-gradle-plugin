repositories {
    maven {
        url "http://repo1.phx.gapinc.dev/artifactory/libs-release"
    }
    ivy {
        layout "maven"
        url "http://repo1.phx.gapinc.dev/artifactory/libs-release"
    }
    maven {
        url "http://artifactory.gapinc.dev/artifactory/local-non-prod"
    }
    ivy {
        layout "maven"
        url "http://artifactory.gapinc.dev/artifactory/local-non-prod"
    }
}

buildscript {
    repositories {
        ivy {
            layout 'maven'
            url "http://ci.gap.dev/artifactory/libs-release"
        }
    }
    dependencies{
        classpath 'com.gap:gap-pipeline-plugin:1.0.0.+'
    }
}

//User defined
ext.majorVersion = 1
ext.minorVersion = 2

group 'com.gap'
version = "${majorVersion}.${minorVersion}.${release}.${counter}"

apply plugin: 'groovy'
apply plugin: 'idea'
apply plugin: 'eclipse'
apply plugin: 'gappipeline'


dependencies{
    compile gradleApi()
    groovy localGroovy()

    /* Following 4 dependencies are required for gradle cobertura plugin */
    compile 'gradle_cobertura:gradle_cobertura:1.1'
    compile 'net.sourceforge.cobertura:cobertura:1.9.4.1'
    compile 'asm:asm-all:3.3.1'
    compile 'oro:oro:2.0.8'
    compile 'org.codehaus.groovy.modules.http-builder:http-builder:0.6'
    compile 'org.apache.httpcomponents:httpclient:4.3.1'

    testCompile 'junit:junit:4.8.2'
    testCompile 'org.hamcrest:hamcrest-core:1.2'
    testCompile 'org.hamcrest:hamcrest-library:1.2'
    testCompile 'org.mockito:mockito-core:1.9.5'
    testCompile 'com.cyrusinnovation:mockito-groovy-support:1.3'
}

task echoVersion << {
    println "${version}"
}

sourceSets {
    integrationTest {
        compileClasspath = sourceSets.main.output + configurations.testRuntime
        runtimeClasspath = output + sourceSets.main.output + configurations.testRuntime
        groovy {
            srcDir 'src/integrationTest/groovy'
        }
    }
}

task integrationTest(type: Test, dependsOn: 'test') {
    testClassesDir = sourceSets.integrationTest.output.classesDir
    classpath = sourceSets.integrationTest.runtimeClasspath
}

check.dependsOn << 'integrationTest'

tasks.withType(Test) {
    testLogging {
        showStandardStreams true
        exceptionFormat 'full'
        showExceptions true
        showCauses true
        showStackTraces true
    }
}

uploadArchives {
    repositories {
        ivy {
            layout 'maven'
            url "http://artifactory.gapinc.dev/artifactory/local-non-prod"
            credentials {
                username "admin"
                password "password"
            }
        }
    }
}
