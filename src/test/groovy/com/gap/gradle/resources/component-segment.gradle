segment {
    prepare {
        build_war {
            action 'WM Exec:Run'
            parameters {
                cmd {
                    value './gradlew war'
                }
            }
        }
    }
    test {
        unit_test {
            action 'WM Exec:Run'
            parameters {
                cmd {
                    value './gradlew test'
                }
            }
        }
    }
    jobLinks {
        Google {
            link 'http://www.google.com'
        }
        Gap {
            link 'http://www.gap.com'
        }
    }
    approve {
        '0_sonar' {
            action 'WM Exec:Run'
            parameters {
                cmd {
                    value './gradlew sonar -Pversion=$[/myJob/version]'
                }
            }
        }
        'domain-a Junit Results' {
            action 'WM Gradle:Copy reports'
            runOrder 'parallel'
            runCondition 'always'
            parameters {
                reportsDir {
                    value '$[/myJob/watchmen_config/workingDir]/app-a/domain-a/build/reports/tests'
                }
            }
        }
        'app-a Junit Results' {
            action 'WM Gradle:Copy reports'
            runOrder 'parallel'
            runCondition 'always'
            parameters {
                reportsDir {
                    value '$[/myJob/watchmen_config/workingDir]/app-a/webapp-a/build/reports/tests'
                }
            }
        }
        'domain-b Junit Results' {
            action 'WM Gradle:Copy reports'
            runOrder 'parallel'
            runCondition 'always'
            parameters {
                reportsDir {
                    value '$[/myJob/watchmen_config/workingDir]/app-b/domain-b/build/reports/tests'
                }
            }
        }
        'app-b Junit Results' {
            action 'WM Gradle:Copy reports'
            runOrder 'parallel'
            runCondition 'always'
            parameters {
                reportsDir {
                    value '$[/myJob/watchmen_config/workingDir]/app-b/webapp-b/build/reports/tests'
                }
            }
        }
        '5_publish' {
            action 'WM Exec:Run'
            parameters {
                cmd {
                    value './gradlew packageRpm -Pversion=$[/myJob/version]'
                }
            }
        }
        '6_publish' {
            action 'WM Publish:RPM'
            parameters {
                channel {
                    value 'devel'
                }
                repoName {
                    value 'watchmen'
                }
                sourcePath {
                    value 'build/distributions/ref-app-$[/myJob/version]-1.noarch.rpm'
                }
            }
        }
        upload_archives {
            action 'WM Exec:Run'
            parameters {
                cmd {
                    value './gradlew uploadArchives -Pversion=$[/myJob/version]'
                }
            }
        }
    }
    _finally {
        '0_final' {
            action 'test_final'
        }
    }
}